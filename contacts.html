<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Management System - Final</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --primary-color: #0d6efd;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #6c757d;
            --text-color: #212529;
            --white-color: #ffffff;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-strong: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-gray);
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }

        /* --- Layout e Componentes Gerais --- */
        .top-header {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 12px 24px;
            background-color: var(--white-color);
            border-bottom: 1px solid var(--medium-gray);
            gap: 20px;
        }
        .top-header .icon { font-size: 20px; position: relative; cursor: pointer; }
        .top-header .icon .badge {
            position: absolute; top: -5px; right: -8px;
            background-color: #dc3545; color: white;
            font-size: 10px; font-weight: 600;
            width: 16px; height: 16px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }
        .top-header .user-avatar { width: 32px; height: 32px; border-radius: 50%;}

        .main-container {
            max-width: 800px;
            margin: 24px auto;
            padding: 24px;
        }

        .view { display: none; }
        .view.active { display: block; }
        
        .btn {
            padding: 10px 18px; border-radius: var(--border-radius);
            font-weight: 600; cursor: pointer; border: 1px solid transparent;
            text-decoration: none; display: inline-block;
        }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-secondary { background-color: #eee; border-color: #ddd; color: var(--text-color); }
        .btn-link { background: none; border: none; color: var(--primary-color); padding: 0; font-weight: 500;}

        /* --- Tela da Lista de Contatos --- */
        #contactsListView h1 { font-size: 28px; margin-bottom: 24px; }
        .search-container {
            position: relative;
            margin-bottom: 24px;
        }
        .search-container .search-icon { position: absolute; top: 50%; left: 16px; transform: translateY(-50%); color: var(--dark-gray); }
        .search-container input {
            width: 100%;
            padding: 12px 12px 12px 48px;
            border-radius: var(--border-radius);
            border: 1px solid var(--medium-gray);
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .contact-list { display: flex; flex-direction: column; gap: 12px; }
        .contact-item {
            display: flex; align-items: center; gap: 16px;
            padding: 16px;
            background-color: var(--white-color);
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: box-shadow 0.2s, transform 0.2s;
        }
        .contact-item:hover { box-shadow: var(--shadow); transform: translateY(-2px); }
        .contact-item .contact-icon { font-size: 20px; }
        .contact-item .contact-info { flex-grow: 1; }
        .contact-item .contact-name { font-weight: 600; }
        .contact-item .view-project-link { font-size: 13px; color: var(--primary-color); text-decoration: none; font-weight: 500; }
        .contact-item .more-options { font-size: 20px; color: var(--dark-gray); padding: 4px; cursor: pointer; }

        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: var(--shadow-strong);
            cursor: pointer;
            transition: transform 0.2s;
        }
        .fab:hover { transform: scale(1.1); }

        /* --- Tela de Detalhes do Contato --- */
        #contactDetailView .back-link { margin-bottom: 24px; display: inline-block; }
        .detail-card {
            background-color: var(--white-color); border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius); padding: 24px;
        }
        .detail-header { margin-bottom: 24px; }
        .detail-header h2 { margin: 0 0 4px 0; }
        .detail-header .company-link { color: var(--dark-gray); font-weight: 500; }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--medium-gray);
            padding-bottom: 8px;
            margin-bottom: 16px;
        }
        .section-header h3 { font-size: 18px; margin: 0;}

        .history-item { padding: 12px; border: 1px solid #f0f0f0; border-radius: var(--border-radius); margin-bottom: 12px; }
        .history-item .job-info { font-weight: 600; }
        .history-item .experience-notes { margin-top: 8px; padding-left: 12px; border-left: 3px solid #ccc; font-style: italic; color: #555;}
        .history-item .meta-info { font-size: 13px; color: var(--dark-gray); margin-top: 8px; }

        /* --- Modal --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 100;
            display: none; align-items: center; justify-content: center;
        }
        .modal-overlay.active { display: flex; }
        .modal-content {
            background: white; padding: 32px; border-radius: 12px;
            width: 90%; max-width: 500px;
        }
        .modal-content h2 { margin-top: 0; }
        .modal-content .form-group { margin-bottom: 16px; }
        .modal-content label { display: block; margin-bottom: 6px; font-weight: 500; }
        .modal-content input, .modal-content select, .modal-content textarea { width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #ccc; box-sizing: border-box; }
        .modal-content .form-actions { display: flex; justify-content: flex-end; gap: 12px; margin-top: 24px; }

    </style>
</head>
<body>
    <header class="top-header">
        <span class="icon">üîî<span class="badge">3</span></span>
        <img class="user-avatar" src="https://i.pravatar.cc/40?u=user1" alt="User Avatar">
    </header>

    <!-- ===== VIEW 1: CONTACTS LIST (initial view) ===== -->
    <div id="contactsListView" class="view active">
        <main class="main-container">
            <h1>Contacts</h1>
            <div class="search-container">
                <span class="search-icon">üîç</span>
                <input type="text" id="searchInput" placeholder="Search contacts">
            </div>
            <div class="contact-list" id="contactListContainer">
                <!-- JS populates this -->
            </div>
        </main>
        <div class="fab" id="showAddContactModalBtn" title="Add New Contact">+</div>
    </div>
    
    <!-- ===== VIEW 2: CONTACT DETAIL ===== -->
    <div id="contactDetailView" class="view">
         <main class="main-container">
            <a href="#" class="btn-link back-link" data-target="contactsListView">&larr; Back to All Contacts</a>
            <div class="detail-card">
                <div class="detail-header">
                    <h2 id="contactName"></h2>
                    <div class="company-link">Works at <strong id="contactCompanyName"></strong></div>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <h3>Interaction History</h3>
                        <button class="btn btn-secondary" id="showAddInteractionBtn">Add Interaction</button>
                    </div>
                    <div id="interactionHistory">
                        <!-- JS populates this -->
                    </div>
                </div>
            </div>
         </main>
    </div>

    <!-- ===== MODAL: ADD NEW CONTACT ===== -->
    <div id="addContactModal" class="modal-overlay">
        <div class="modal-content">
            <h2>Add New Contact</h2>
            <div class="form-group">
                <label for="newContactName">Contact Name</label>
                <input type="text" id="newContactName" placeholder="e.g., Jay Temple">
            </div>
            <div class="form-group">
                <label for="newContactCompany">Company</label>
                <select id="newContactCompany"></select>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary closeModalBtn">Cancel</button>
                <button class="btn btn-primary" id="saveContactBtn">Save Contact</button>
            </div>
        </div>
    </div>
    
    <!-- ===== MODAL: ADD INTERACTION ===== -->
    <div id="addInteractionModal" class="modal-overlay">
        <div class="modal-content">
            <h2>Add Interaction for <span id="interactionContactName"></span></h2>
            <div class="form-group">
                <label for="interactionJobName">Job Name / Address</label>
                <input type="text" id="interactionJobName" placeholder="e.g., 123 Main St">
            </div>
            <div class="form-group">
                <label for="experienceNotes">Experience Notes</label>
                <textarea id="experienceNotes" placeholder="e.g., Great attitude, new to the company..."></textarea>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary closeModalBtn">Cancel</button>
                <button class="btn btn-primary" id="saveInteractionBtn">Save Interaction</button>
            </div>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Mock Data ---
        let db = {
            companies: {
                '1': { name: 'Ladder Now' }, '2': { name: 'Allstate' }, '3': { name: 'State Farm' }
            },
            contacts: [
                { id: '1222', name: 'Ricky Cramer', companyId: '1' },
                { id: '1646', name: 'Kathy Battershell', companyId: '2' },
                { id: '1718', name: 'Miriam Lee', companyId: '1' },
                { id: '1743', name: 'Barbara Woolsey', companyId: '2' },
                { id: '1760', name: 'Christie Gotti', companyId: '3' },
                { id: '1791', name: 'Michael Galassi', companyId: '1' },
                { id: '2297', name: 'Bob Bare', companyId: '3' },
                { id: '3030', name: 'Jay Temple', companyId: '1'}
            ],
            jobInteractions: [
                { id: 1, contactId: '1791', jobName: '456 Oak Ave', date: 'June 20, 2025', rep: 'Adam Ulrich', notes: 'He was just on a roof with me... freaking awesome, good to meet you, I\'m new in the company.' },
                { id: 2, contactId: '1743', jobName: '789 Pine Ln', date: 'June 15, 2025', rep: 'Jessica Day', notes: 'Very helpful, got the roof paid for quickly.'},
                { id: 3, contactId: '3030', jobName: '111 Birch Rd', date: 'May 28, 2025', rep: 'Olliver Barros', notes: 'Initial meeting went well. Seems knowledgeable.'}
            ]
        };

        let currentContactId = null;

        // --- Render Functions ---
        const renderContactList = (filter = '') => {
            const container = document.getElementById('contactListContainer');
            container.innerHTML = '';
            const filteredContacts = db.contacts.filter(c => c.name.toLowerCase().includes(filter.toLowerCase()));
            
            filteredContacts.forEach(contact => {
                const hasProject = db.jobInteractions.some(i => i.contactId === contact.id);
                const projectLinkHtml = hasProject ? `<a href="#" class="view-project-link" data-contact-id="${contact.id}">View project</a>` : '';
                const itemHtml = `
                    <div class="contact-item" data-contact-id="${contact.id}">
                        <span class="contact-icon">üë§</span>
                        <div class="contact-info">
                            <div class="contact-name">${contact.id}: ${contact.name}</div>
                            ${projectLinkHtml}
                        </div>
                        <span class="more-options">‚ãÆ</span>
                    </div>
                `;
                container.innerHTML += itemHtml;
            });
        };

        const renderContactDetail = (contactId) => {
            currentContactId = contactId;
            const contact = db.contacts.find(c => c.id === contactId);
            if (!contact) return;
            
            const company = db.companies[contact.companyId];
            
            document.getElementById('contactName').textContent = `${contact.id}: ${contact.name}`;
            document.getElementById('contactCompanyName').textContent = company.name;
            
            const historyEl = document.getElementById('interactionHistory');
            historyEl.innerHTML = '';
            const interactions = db.jobInteractions.filter(i => i.contactId === contactId).sort((a,b) => new Date(b.date) - new Date(a.date));

            if (interactions.length > 0) {
                 interactions.forEach(item => {
                    historyEl.innerHTML += `
                        <div class="history-item">
                            <div class="job-info">Job: ${item.jobName}</div>
                            <div class="experience-notes">"${item.notes}"</div>
                            <div class="meta-info">
                                with rep <strong>${item.rep}</strong> on ${item.date}
                            </div>
                        </div>`;
                });
            } else {
                historyEl.innerHTML = '<p>No interaction history recorded for this contact.</p>';
            }
        };
        
        const populateCompanyDropdown = () => {
            const select = document.getElementById('newContactCompany');
            select.innerHTML = '';
            for (const id in db.companies) {
                select.innerHTML += `<option value="${id}">${db.companies[id].name}</option>`;
            }
        };

        // --- Navigation Logic ---
        const showView = (viewId) => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId)?.classList.add('active');
        };
        
        document.body.addEventListener('click', (e) => {
            const contactItem = e.target.closest('.contact-item');
            if (contactItem && !e.target.matches('.more-options, .view-project-link')) {
                e.preventDefault();
                const contactId = contactItem.dataset.contactId;
                renderContactDetail(contactId);
                showView('contactDetailView');
            }

            const backLink = e.target.closest('.back-link');
            if (backLink) {
                 e.preventDefault();
                 showView(backLink.dataset.target);
            }
        });

        // --- Modal Logic ---
        const openModal = (modalId) => document.getElementById(modalId).classList.add('active');
        const closeModal = () => document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
        
        document.getElementById('showAddContactModalBtn').addEventListener('click', () => {
             populateCompanyDropdown();
             openModal('addContactModal');
        });
        document.getElementById('showAddInteractionBtn').addEventListener('click', () => {
            const contact = db.contacts.find(c => c.id === currentContactId);
            document.getElementById('interactionContactName').textContent = contact.name;
            openModal('addInteractionModal');
        });
        document.querySelectorAll('.closeModalBtn').forEach(btn => btn.addEventListener('click', closeModal));

        // --- Data Manipulation ---
        document.getElementById('saveContactBtn').addEventListener('click', () => {
            const name = document.getElementById('newContactName').value;
            const companyId = document.getElementById('newContactCompany').value;
            if (name && companyId) {
                const newId = String(Math.floor(Math.random() * 9000) + 1000);
                db.contacts.push({ id: newId, name, companyId });
                renderContactList();
                closeModal();
                document.getElementById('newContactName').value = '';
            }
        });
        
        document.getElementById('saveInteractionBtn').addEventListener('click', () => {
            const jobName = document.getElementById('interactionJobName').value;
            const notes = document.getElementById('experienceNotes').value;
            if (jobName && notes && currentContactId) {
                const newId = db.jobInteractions.length + 1;
                const date = new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
                db.jobInteractions.push({ id: newId, contactId: currentContactId, jobName, notes, rep: 'Olliver Barros', date });
                renderContactDetail(currentContactId);
                closeModal();
                document.getElementById('interactionJobName').value = '';
                document.getElementById('experienceNotes').value = '';
            }
        });
        
        document.getElementById('searchInput').addEventListener('input', (e) => {
            renderContactList(e.target.value);
        });
        
        // --- Initial Render ---
        renderContactList();
    });
    </script>
</body>
</html>
